{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar CollectionMode;\n(function (CollectionMode) {\n  CollectionMode[CollectionMode[\"key\"] = 0] = \"key\";\n  CollectionMode[CollectionMode[\"value\"] = 1] = \"value\";\n})(CollectionMode || (CollectionMode = {}));\nconst CONFIG = Object.freeze({\n  key: {\n    terminator: '=',\n    quotes: {}\n  },\n  value: {\n    terminator: ';',\n    quotes: {\n      '\"': '\"',\n      \"'\": \"'\",\n      '{': '}'\n    }\n  }\n});\nfunction connectionStringParser(connectionString) {\n  let parserConfig = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : CONFIG;\n  const parsed = {};\n  let collectionMode = CollectionMode.key;\n  let started = false;\n  let finished = false;\n  let quoted = false;\n  let quote = '';\n  let buffer = '';\n  let currentKey = '';\n  let pointer = 0;\n  function start() {\n    started = true;\n  }\n  function finish() {\n    finished = true;\n  }\n  function reset() {\n    started = false;\n    finished = false;\n    quoted = false;\n    quote = '';\n    buffer = '';\n  }\n  function config() {\n    return collectionMode === CollectionMode.key ? parserConfig.key : parserConfig.value;\n  }\n  function isTerminator(char) {\n    return config().terminator === char;\n  }\n  function isStartQuote(char) {\n    return Object.keys(config().quotes).some(val => char === val);\n  }\n  function isEndQuote(char) {\n    return quoted && char === config().quotes[quote];\n  }\n  function push(char) {\n    buffer += char;\n  }\n  function collect() {\n    if (!quoted) {\n      buffer = buffer.trim();\n    }\n    switch (collectionMode) {\n      case CollectionMode.key:\n        currentKey = buffer.toLowerCase();\n        collectionMode = CollectionMode.value;\n        break;\n      case CollectionMode.value:\n        collectionMode = CollectionMode.key;\n        parsed[currentKey] = buffer;\n        currentKey = '';\n        break;\n    }\n    reset();\n  }\n  while (pointer < connectionString.length) {\n    const current = connectionString.charAt(pointer);\n    if (!finished) {\n      if (!started) {\n        if (current.trim()) {\n          start();\n          if (isStartQuote(current)) {\n            quoted = true;\n            quote = current;\n          } else {\n            push(current);\n          }\n        }\n      } else {\n        if (quoted && isEndQuote(current)) {\n          const next = connectionString.charAt(pointer + 1);\n          if (current === next) {\n            push(current);\n            pointer++;\n          } else {\n            finish();\n          }\n        } else if (!quoted && isTerminator(current)) {\n          const next = connectionString.charAt(pointer + 1);\n          if (current === next) {\n            push(current);\n            pointer++;\n          } else {\n            collect();\n          }\n        } else {\n          push(current);\n        }\n      }\n    } else if (isTerminator(current)) {\n      collect();\n    } else if (current.trim()) {\n      throw new Error('Malformed connection string');\n    }\n    pointer++;\n  }\n  if (quoted && !finished) {\n    throw new Error('Connection string terminated unexpectedly');\n  } else {\n    collect();\n  }\n  return parsed;\n}\nexports.default = connectionStringParser;","map":{"version":3,"names":["CollectionMode","CONFIG","Object","freeze","key","terminator","quotes","value","connectionStringParser","connectionString","parserConfig","arguments","length","undefined","parsed","collectionMode","started","finished","quoted","quote","buffer","currentKey","pointer","start","finish","reset","config","isTerminator","char","isStartQuote","keys","some","val","isEndQuote","push","collect","trim","toLowerCase","current","charAt","next","Error","exports","default"],"sources":["../../src/parser/connection-string.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}