{"ast":null,"code":"'use strict';\n\nvar _classCallCheck = require(\"/Users/shahwalikhan/Desktop/my-app/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _createClass = require(\"/Users/shahwalikhan/Desktop/my-app/node_modules/@babel/runtime/helpers/createClass.js\").default;\nvar _get = require(\"/Users/shahwalikhan/Desktop/my-app/node_modules/@babel/runtime/helpers/get.js\").default;\nvar _getPrototypeOf = require(\"/Users/shahwalikhan/Desktop/my-app/node_modules/@babel/runtime/helpers/getPrototypeOf.js\").default;\nvar _inherits = require(\"/Users/shahwalikhan/Desktop/my-app/node_modules/@babel/runtime/helpers/inherits.js\").default;\nvar _createSuper = require(\"/Users/shahwalikhan/Desktop/my-app/node_modules/@babel/runtime/helpers/createSuper.js\").default;\nvar debug = require('debug')('mssql:tedi');\nvar BaseTransaction = require('../base/transaction');\nvar _require = require('../utils'),\n  IDS = _require.IDS;\nvar TransactionError = require('../error/transaction-error');\nvar Transaction = /*#__PURE__*/function (_BaseTransaction) {\n  _inherits(Transaction, _BaseTransaction);\n  var _super = _createSuper(Transaction);\n  function Transaction(parent) {\n    var _this;\n    _classCallCheck(this, Transaction);\n    _this = _super.call(this, parent);\n    _this._abort = function () {\n      if (!_this._rollbackRequested) {\n        // transaction interrupted because of XACT_ABORT\n\n        var pc = _this._acquiredConnection;\n\n        // defer releasing so connection can switch from SentClientRequest to LoggedIn state\n        setImmediate(_this.parent.release.bind(_this.parent), pc);\n        _this._acquiredConnection.removeListener('rollbackTransaction', _this._abort);\n        _this._acquiredConnection = null;\n        _this._acquiredConfig = null;\n        _this._aborted = true;\n        _this.emit('rollback', true);\n      }\n    };\n    return _this;\n  }\n  _createClass(Transaction, [{\n    key: \"_begin\",\n    value: function _begin(isolationLevel, callback) {\n      var _this2 = this;\n      _get(_getPrototypeOf(Transaction.prototype), \"_begin\", this).call(this, isolationLevel, function (err) {\n        if (err) return callback(err);\n        debug('transaction(%d): begin', IDS.get(_this2));\n        _this2.parent.acquire(_this2, function (err, connection, config) {\n          if (err) return callback(err);\n          _this2._acquiredConnection = connection;\n          _this2._acquiredConnection.on('rollbackTransaction', _this2._abort);\n          _this2._acquiredConfig = config;\n          connection.beginTransaction(function (err) {\n            if (err) err = new TransactionError(err);\n            debug('transaction(%d): begun', IDS.get(_this2));\n            callback(err);\n          }, _this2.name, _this2.isolationLevel);\n        });\n      });\n    }\n  }, {\n    key: \"_commit\",\n    value: function _commit(callback) {\n      var _this3 = this;\n      _get(_getPrototypeOf(Transaction.prototype), \"_commit\", this).call(this, function (err) {\n        if (err) return callback(err);\n        debug('transaction(%d): commit', IDS.get(_this3));\n        _this3._acquiredConnection.commitTransaction(function (err) {\n          if (err) err = new TransactionError(err);\n          _this3._acquiredConnection.removeListener('rollbackTransaction', _this3._abort);\n          _this3.parent.release(_this3._acquiredConnection);\n          _this3._acquiredConnection = null;\n          _this3._acquiredConfig = null;\n          if (!err) debug('transaction(%d): commited', IDS.get(_this3));\n          callback(err);\n        });\n      });\n    }\n  }, {\n    key: \"_rollback\",\n    value: function _rollback(callback) {\n      var _this4 = this;\n      _get(_getPrototypeOf(Transaction.prototype), \"_rollback\", this).call(this, function (err) {\n        if (err) return callback(err);\n        debug('transaction(%d): rollback', IDS.get(_this4));\n        _this4._acquiredConnection.rollbackTransaction(function (err) {\n          if (err) err = new TransactionError(err);\n          _this4._acquiredConnection.removeListener('rollbackTransaction', _this4._abort);\n          _this4.parent.release(_this4._acquiredConnection);\n          _this4._acquiredConnection = null;\n          _this4._acquiredConfig = null;\n          if (!err) debug('transaction(%d): rolled back', IDS.get(_this4));\n          callback(err);\n        });\n      });\n    }\n  }]);\n  return Transaction;\n}(BaseTransaction);\nmodule.exports = Transaction;","map":{"version":3,"names":["_classCallCheck","require","default","_createClass","_get","_getPrototypeOf","_inherits","_createSuper","debug","BaseTransaction","_require","IDS","TransactionError","Transaction","_BaseTransaction","_super","parent","_this","call","_abort","_rollbackRequested","pc","_acquiredConnection","setImmediate","release","bind","removeListener","_acquiredConfig","_aborted","emit","key","value","_begin","isolationLevel","callback","_this2","prototype","err","get","acquire","connection","config","on","beginTransaction","name","_commit","_this3","commitTransaction","_rollback","_this4","rollbackTransaction","module","exports"],"sources":["/Users/shahwalikhan/Desktop/my-app/node_modules/mssql/lib/tedious/transaction.js"],"sourcesContent":["'use strict'\n\nconst debug = require('debug')('mssql:tedi')\nconst BaseTransaction = require('../base/transaction')\nconst { IDS } = require('../utils')\nconst TransactionError = require('../error/transaction-error')\n\nclass Transaction extends BaseTransaction {\n  constructor (parent) {\n    super(parent)\n\n    this._abort = () => {\n      if (!this._rollbackRequested) {\n        // transaction interrupted because of XACT_ABORT\n\n        const pc = this._acquiredConnection\n\n        // defer releasing so connection can switch from SentClientRequest to LoggedIn state\n        setImmediate(this.parent.release.bind(this.parent), pc)\n\n        this._acquiredConnection.removeListener('rollbackTransaction', this._abort)\n        this._acquiredConnection = null\n        this._acquiredConfig = null\n        this._aborted = true\n\n        this.emit('rollback', true)\n      }\n    }\n  }\n\n  _begin (isolationLevel, callback) {\n    super._begin(isolationLevel, err => {\n      if (err) return callback(err)\n\n      debug('transaction(%d): begin', IDS.get(this))\n\n      this.parent.acquire(this, (err, connection, config) => {\n        if (err) return callback(err)\n\n        this._acquiredConnection = connection\n        this._acquiredConnection.on('rollbackTransaction', this._abort)\n        this._acquiredConfig = config\n\n        connection.beginTransaction(err => {\n          if (err) err = new TransactionError(err)\n\n          debug('transaction(%d): begun', IDS.get(this))\n\n          callback(err)\n        }, this.name, this.isolationLevel)\n      })\n    })\n  }\n\n  _commit (callback) {\n    super._commit(err => {\n      if (err) return callback(err)\n\n      debug('transaction(%d): commit', IDS.get(this))\n\n      this._acquiredConnection.commitTransaction(err => {\n        if (err) err = new TransactionError(err)\n\n        this._acquiredConnection.removeListener('rollbackTransaction', this._abort)\n        this.parent.release(this._acquiredConnection)\n        this._acquiredConnection = null\n        this._acquiredConfig = null\n\n        if (!err) debug('transaction(%d): commited', IDS.get(this))\n\n        callback(err)\n      })\n    })\n  }\n\n  _rollback (callback) {\n    super._rollback(err => {\n      if (err) return callback(err)\n\n      debug('transaction(%d): rollback', IDS.get(this))\n\n      this._acquiredConnection.rollbackTransaction(err => {\n        if (err) err = new TransactionError(err)\n\n        this._acquiredConnection.removeListener('rollbackTransaction', this._abort)\n        this.parent.release(this._acquiredConnection)\n        this._acquiredConnection = null\n        this._acquiredConfig = null\n\n        if (!err) debug('transaction(%d): rolled back', IDS.get(this))\n\n        callback(err)\n      })\n    })\n  }\n}\n\nmodule.exports = Transaction\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}