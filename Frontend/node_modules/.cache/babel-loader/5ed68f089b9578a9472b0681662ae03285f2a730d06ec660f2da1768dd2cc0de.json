{"ast":null,"code":"'use strict';\n\nconst shared = require('./shared');\nlet globalConnection = null;\nconst globalConnectionHandlers = {};\n\n/**\n * Open global connection pool.\n *\n * @param {Object|String} config Connection configuration object or connection string.\n * @param {basicCallback} [callback] A callback which is called after connection has established, or an error has occurred. If omited, method returns Promise.\n * @return {Promise.<ConnectionPool>}\n */\n\nfunction connect(config, callback) {\n  if (!globalConnection) {\n    globalConnection = new shared.driver.ConnectionPool(config);\n    for (const event in globalConnectionHandlers) {\n      for (let i = 0, l = globalConnectionHandlers[event].length; i < l; i++) {\n        globalConnection.on(event, globalConnectionHandlers[event][i]);\n      }\n    }\n    const ogClose = globalConnection.close;\n    const globalClose = function (callback) {\n      // remove event handlers from the global connection\n      for (const event in globalConnectionHandlers) {\n        for (let i = 0, l = globalConnectionHandlers[event].length; i < l; i++) {\n          this.removeListener(event, globalConnectionHandlers[event][i]);\n        }\n      }\n\n      // attach error handler to prevent process crash in case of error\n      this.on('error', err => {\n        if (globalConnectionHandlers.error) {\n          for (let i = 0, l = globalConnectionHandlers.error.length; i < l; i++) {\n            globalConnectionHandlers.error[i].call(this, err);\n          }\n        }\n      });\n      globalConnection = null;\n      return ogClose.call(this, callback);\n    };\n    globalConnection.close = globalClose.bind(globalConnection);\n  }\n  if (typeof callback === 'function') {\n    return globalConnection.connect((err, connection) => {\n      if (err) {\n        globalConnection = null;\n      }\n      callback(err, connection);\n    });\n  }\n  return globalConnection.connect().catch(err => {\n    globalConnection = null;\n    return shared.Promise.reject(err);\n  });\n}\n\n/**\n * Close all active connections in the global pool.\n *\n * @param {basicCallback} [callback] A callback which is called after connection has closed, or an error has occurred. If omited, method returns Promise.\n * @return {ConnectionPool|Promise}\n */\n\nfunction close(callback) {\n  if (globalConnection) {\n    const gc = globalConnection;\n    globalConnection = null;\n    return gc.close(callback);\n  }\n  if (typeof callback === 'function') {\n    setImmediate(callback);\n    return null;\n  }\n  return new shared.Promise(resolve => {\n    resolve(globalConnection);\n  });\n}\n\n/**\n * Attach event handler to global connection pool.\n *\n * @param {String} event Event name.\n * @param {Function} handler Event handler.\n * @return {ConnectionPool}\n */\n\nfunction on(event, handler) {\n  if (!globalConnectionHandlers[event]) globalConnectionHandlers[event] = [];\n  globalConnectionHandlers[event].push(handler);\n  if (globalConnection) globalConnection.on(event, handler);\n  return globalConnection;\n}\n\n/**\n * Detach event handler from global connection.\n *\n * @param {String} event Event name.\n * @param {Function} handler Event handler.\n * @return {ConnectionPool}\n */\n\nfunction removeListener(event, handler) {\n  if (!globalConnectionHandlers[event]) return globalConnection;\n  const index = globalConnectionHandlers[event].indexOf(handler);\n  if (index === -1) return globalConnection;\n  globalConnectionHandlers[event].splice(index, 1);\n  if (globalConnectionHandlers[event].length === 0) globalConnectionHandlers[event] = undefined;\n  if (globalConnection) globalConnection.removeListener(event, handler);\n  return globalConnection;\n}\n\n/**\n * Creates a new query using global connection from a tagged template string.\n *\n * @variation 1\n * @param {Array|String} strings Array of string literals or sql command.\n * @param {...*} keys Values.\n * @return {Request}\n */\n\n/**\n * Execute the SQL command.\n *\n * @variation 2\n * @param {String} command T-SQL command to be executed.\n * @param {Request~requestCallback} [callback] A callback which is called after execution has completed, or an error has occurred. If omited, method returns Promise.\n * @return {Request|Promise}\n */\n\nfunction query() {\n  if (typeof arguments[0] === 'string') {\n    return new shared.driver.Request().query(arguments[0], arguments[1]);\n  }\n  const values = Array.prototype.slice.call(arguments);\n  const strings = values.shift();\n  return new shared.driver.Request()._template(strings, values, 'query');\n}\n\n/**\n * Creates a new batch using global connection from a tagged template string.\n *\n * @variation 1\n * @param {Array} strings Array of string literals.\n * @param {...*} keys Values.\n * @return {Request}\n */\n\n/**\n * Execute the SQL command.\n *\n * @variation 2\n * @param {String} command T-SQL command to be executed.\n * @param {Request~requestCallback} [callback] A callback which is called after execution has completed, or an error has occurred. If omited, method returns Promise.\n * @return {Request|Promise}\n */\n\nfunction batch() {\n  if (typeof arguments[0] === 'string') {\n    return new shared.driver.Request().batch(arguments[0], arguments[1]);\n  }\n  const values = Array.prototype.slice.call(arguments);\n  const strings = values.shift();\n  return new shared.driver.Request()._template(strings, values, 'batch');\n}\nmodule.exports = {\n  batch,\n  close,\n  connect,\n  off: removeListener,\n  on,\n  query,\n  removeListener\n};\nObject.defineProperty(module.exports, 'pool', {\n  get: () => {\n    return globalConnection;\n  },\n  set: () => {}\n});","map":{"version":3,"names":["shared","require","globalConnection","globalConnectionHandlers","connect","config","callback","driver","ConnectionPool","event","i","l","length","on","ogClose","close","globalClose","removeListener","err","error","call","bind","connection","catch","Promise","reject","gc","setImmediate","resolve","handler","push","index","indexOf","splice","undefined","query","arguments","Request","values","Array","prototype","slice","strings","shift","_template","batch","module","exports","off","Object","defineProperty","get","set"],"sources":["/Users/shahwalikhan/Desktop/my-app/node_modules/mssql/lib/global-connection.js"],"sourcesContent":["'use strict'\n\nconst shared = require('./shared')\n\nlet globalConnection = null\nconst globalConnectionHandlers = {}\n\n/**\n * Open global connection pool.\n *\n * @param {Object|String} config Connection configuration object or connection string.\n * @param {basicCallback} [callback] A callback which is called after connection has established, or an error has occurred. If omited, method returns Promise.\n * @return {Promise.<ConnectionPool>}\n */\n\nfunction connect (config, callback) {\n  if (!globalConnection) {\n    globalConnection = new shared.driver.ConnectionPool(config)\n\n    for (const event in globalConnectionHandlers) {\n      for (let i = 0, l = globalConnectionHandlers[event].length; i < l; i++) {\n        globalConnection.on(event, globalConnectionHandlers[event][i])\n      }\n    }\n\n    const ogClose = globalConnection.close\n\n    const globalClose = function (callback) {\n      // remove event handlers from the global connection\n      for (const event in globalConnectionHandlers) {\n        for (let i = 0, l = globalConnectionHandlers[event].length; i < l; i++) {\n          this.removeListener(event, globalConnectionHandlers[event][i])\n        }\n      }\n\n      // attach error handler to prevent process crash in case of error\n      this.on('error', err => {\n        if (globalConnectionHandlers.error) {\n          for (let i = 0, l = globalConnectionHandlers.error.length; i < l; i++) {\n            globalConnectionHandlers.error[i].call(this, err)\n          }\n        }\n      })\n\n      globalConnection = null\n      return ogClose.call(this, callback)\n    }\n\n    globalConnection.close = globalClose.bind(globalConnection)\n  }\n  if (typeof callback === 'function') {\n    return globalConnection.connect((err, connection) => {\n      if (err) {\n        globalConnection = null\n      }\n      callback(err, connection)\n    })\n  }\n  return globalConnection.connect().catch((err) => {\n    globalConnection = null\n    return shared.Promise.reject(err)\n  })\n}\n\n/**\n * Close all active connections in the global pool.\n *\n * @param {basicCallback} [callback] A callback which is called after connection has closed, or an error has occurred. If omited, method returns Promise.\n * @return {ConnectionPool|Promise}\n */\n\nfunction close (callback) {\n  if (globalConnection) {\n    const gc = globalConnection\n    globalConnection = null\n    return gc.close(callback)\n  }\n\n  if (typeof callback === 'function') {\n    setImmediate(callback)\n    return null\n  }\n\n  return new shared.Promise((resolve) => {\n    resolve(globalConnection)\n  })\n}\n\n/**\n * Attach event handler to global connection pool.\n *\n * @param {String} event Event name.\n * @param {Function} handler Event handler.\n * @return {ConnectionPool}\n */\n\nfunction on (event, handler) {\n  if (!globalConnectionHandlers[event]) globalConnectionHandlers[event] = []\n  globalConnectionHandlers[event].push(handler)\n\n  if (globalConnection) globalConnection.on(event, handler)\n  return globalConnection\n}\n\n/**\n * Detach event handler from global connection.\n *\n * @param {String} event Event name.\n * @param {Function} handler Event handler.\n * @return {ConnectionPool}\n */\n\nfunction removeListener (event, handler) {\n  if (!globalConnectionHandlers[event]) return globalConnection\n  const index = globalConnectionHandlers[event].indexOf(handler)\n  if (index === -1) return globalConnection\n  globalConnectionHandlers[event].splice(index, 1)\n  if (globalConnectionHandlers[event].length === 0) globalConnectionHandlers[event] = undefined\n\n  if (globalConnection) globalConnection.removeListener(event, handler)\n  return globalConnection\n}\n\n/**\n * Creates a new query using global connection from a tagged template string.\n *\n * @variation 1\n * @param {Array|String} strings Array of string literals or sql command.\n * @param {...*} keys Values.\n * @return {Request}\n */\n\n/**\n * Execute the SQL command.\n *\n * @variation 2\n * @param {String} command T-SQL command to be executed.\n * @param {Request~requestCallback} [callback] A callback which is called after execution has completed, or an error has occurred. If omited, method returns Promise.\n * @return {Request|Promise}\n */\n\nfunction query () {\n  if (typeof arguments[0] === 'string') { return new shared.driver.Request().query(arguments[0], arguments[1]) }\n\n  const values = Array.prototype.slice.call(arguments)\n  const strings = values.shift()\n\n  return new shared.driver.Request()._template(strings, values, 'query')\n}\n\n/**\n * Creates a new batch using global connection from a tagged template string.\n *\n * @variation 1\n * @param {Array} strings Array of string literals.\n * @param {...*} keys Values.\n * @return {Request}\n */\n\n/**\n * Execute the SQL command.\n *\n * @variation 2\n * @param {String} command T-SQL command to be executed.\n * @param {Request~requestCallback} [callback] A callback which is called after execution has completed, or an error has occurred. If omited, method returns Promise.\n * @return {Request|Promise}\n */\n\nfunction batch () {\n  if (typeof arguments[0] === 'string') { return new shared.driver.Request().batch(arguments[0], arguments[1]) }\n\n  const values = Array.prototype.slice.call(arguments)\n  const strings = values.shift()\n\n  return new shared.driver.Request()._template(strings, values, 'batch')\n}\n\nmodule.exports = {\n  batch,\n  close,\n  connect,\n  off: removeListener,\n  on,\n  query,\n  removeListener\n}\n\nObject.defineProperty(module.exports, 'pool', {\n  get: () => {\n    return globalConnection\n  },\n  set: () => {}\n})\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}